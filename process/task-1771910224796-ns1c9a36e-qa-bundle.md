# QA Bundle — task-1771910224796-ns1c9a36e

## Summary
Add GitHub identity provider abstraction to support:
- PAT from env (GITHUB_TOKEN / GH_TOKEN) fallback
- GitHub App installation tokens minted from a private key stored in SecretVault

Wire `resolvePrAndCi` to use this provider for server-side PR/CI resolution reads.

## Changes
- `src/github-identity.ts`
  - `GitHubIdentityProvider` with modes: `pat` | `app_installation`
  - App mode:
    - reads `private_key_pem`, `app_id`, `installation_id` from SecretVault
    - mints installation token via `POST /app/installations/:id/access_tokens`
    - caches token in-memory until expiry (60s refresh buffer)
  - Falls back to PAT env vars if app mode misconfigured.

- `src/server.ts`
  - Initializes provider after SecretVault init
  - `resolvePrAndCi` now uses `await githubHeaders()` (async) so Authorization comes from provider.
  - Config via env:
    - `REFLECTT_GITHUB_IDENTITY_MODE=pat|app_installation`
    - optional override secret names: `REFLECTT_GITHUB_APP_*_SECRET`

- `tests/github-identity.test.ts`
  - PAT fallback test
  - App mode test asserts `Authorization: Bearer <jwt>` on token mint request and returns installation token.

- `docs/runbooks/github-identity-v1.md`
  - Setup + required vault secrets + env vars.

## Evidence
- `npm test` → 49 files passed, 854 tests passed, 1 skipped.

## How to Validate (manual)
1) PAT mode:
   - set `GITHUB_TOKEN` and leave `REFLECTT_GITHUB_IDENTITY_MODE` unset
   - confirm PR/CI resolution endpoints still work.

2) App mode:
   - store secrets in vault: `github.app.private_key_pem`, `github.app.app_id`, `github.app.installation_id`
   - set `REFLECTT_GITHUB_IDENTITY_MODE=app_installation`
   - confirm PR/CI resolution works without `GITHUB_TOKEN`.

## Caveats
- Per-team scoping is v1-by-env (per node instance). Team-scoped config can be layered later.
